<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>For Momoca ‚ù§Ô∏è</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- LOAD THREE.JS ENGINE -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Dancing+Script:wght@700&display=swap');

        body, html {
            background-color: #000;
            color: white;
            margin: 0; padding: 0;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            height: 100%; width: 100%;
            touch-action: none; /* Mencegah scroll/zoom */
        }

        /* LAYERS Z-INDEX */
        #layer-overlay { z-index: 100; }
        #layer-ui { z-index: 50; }
        #layer-final-text { z-index: 60; }
        #canvas-stickman { z-index: 20; } /* 2D Stickman */
        #canvas-3d { z-index: 10; } /* 3D Flower Background */

        /* 1. START OVERLAY */
        #layer-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 1s ease; cursor: pointer;
        }
        .heart-beat { font-size: 4rem; animation: beat 1.5s infinite; margin-bottom: 20px; }
        .tap-text { font-size: 0.8rem; letter-spacing: 4px; color: #888; text-transform: uppercase; }

        /* 2. INTRO & CHAT UI */
        #layer-ui {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; /* Klik tembus ke canvas kecuali elemen aktif */
            display: flex; justify-content: center; align-items: center;
        }

        .intro-container {
            position: absolute; text-align: center; width: 80%;
            display: flex; flex-direction: column; gap: 15px;
        }
        .intro-line {
            font-size: 1.1rem; opacity: 0; transform: translateY(20px);
            transition: all 1s ease;
        }
        .intro-active { opacity: 1; transform: translateY(0); }

        /* IG CHAT BOX */
        #ig-interface {
            width: 100%; height: 100%; max-width: 420px; background: #000;
            display: none; flex-direction: column; pointer-events: auto;
            border-left: 1px solid #1a1a1a; border-right: 1px solid #1a1a1a;
        }
        .ig-header {
            padding: 15px 20px; border-bottom: 1px solid #262626; display: flex; align-items: center;
        }
        .avatar {
            width: 38px; height: 38px; border-radius: 50%; margin-right: 12px;
            background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888);
            padding: 2px;
        }
        .avatar-inner { width: 100%; height: 100%; background: #222; border-radius: 50%; }
        
        .chat-body { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; }
        
        .msg {
            max-width: 75%; padding: 12px 16px; border-radius: 22px; font-size: 0.95rem;
            position: relative; opacity: 0; transform: translateY(10px); transition: all 0.4s ease;
            line-height: 1.4;
        }
        .msg.show { opacity: 1; transform: translateY(0); }
        .msg-l { align-self: flex-start; background: #262626; border-bottom-left-radius: 4px; }
        .msg-r { align-self: flex-end; background: #3797f0; border-bottom-right-radius: 4px; }

        /* TYPING INDICATOR */
        .typing {
            align-self: flex-start; background: #262626; padding: 15px 20px; border-radius: 22px;
            border-bottom-left-radius: 4px; display: none; width: fit-content; margin-bottom: 10px;
        }
        .dot {
            display: inline-block; width: 7px; height: 7px; background: #bbb; border-radius: 50%;
            margin-right: 4px; animation: bounce 1.4s infinite ease-in-out both;
        }
        .dot:nth-child(1) { animation-delay: -0.32s; }
        .dot:nth-child(2) { animation-delay: -0.16s; }

        /* ACTION BUTTON */
        .action-box {
            padding: 40px 20px; display: none; flex-direction: column; align-items: center; gap: 15px;
            opacity: 0; transition: opacity 1s;
        }
        .btn-main {
            background: white; color: black; border: none; padding: 14px 40px;
            border-radius: 50px; font-weight: 600; font-size: 1rem; cursor: pointer;
            box-shadow: 0 5px 20px rgba(255,255,255,0.15); transition: transform 0.1s;
        }
        .btn-main:active { transform: scale(0.95); }

        /* 3. CANVASES */
        canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        #canvas-3d { opacity: 0; transition: opacity 2s ease; } /* Starts hidden */

        /* FINAL TEXT */
        #layer-final-text {
            position: absolute; bottom: 15%; width: 100%; text-align: center; pointer-events: none;
            font-family: 'Dancing Script', cursive; font-size: 2.5rem; color: #ffcce0;
            text-shadow: 0 0 20px rgba(255, 20, 147, 0.6); opacity: 0; transition: opacity 2s;
        }

        @keyframes beat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
    </style>
</head>
<body>

    <!-- OVERLAY -->
    <div id="layer-overlay">
        <div class="heart-beat">ü•Ä</div>
        <div class="tap-text">Ketuk Layar</div>
        <div style="margin-top:10px; font-size: 0.7rem; color: #444;">Loading 3D Engine...</div>
    </div>

    <!-- UI -->
    <div id="layer-ui">
        <div id="intro-box" class="intro-container">
            <div class="intro-line">Kita jadian 7 Mei 2022...</div>
            <div class="intro-line">Sampai sekarang kita bertahan,</div>
            <div class="intro-line">Walau banyak masalah yang datang.</div>
        </div>

        <div id="ig-interface">
            <div class="ig-header">
                <div class="avatar"><div class="avatar-inner"></div></div>
                <div>
                    <div style="font-weight:600; font-size:0.95rem;">momoca</div>
                    <div style="font-size:0.75rem; color:#888;">Active now</div>
                </div>
            </div>
            <div class="chat-body" id="chat-scroller">
                <div class="typing" id="typing-dots">
                    <div class="dot"></div><div class="dot"></div><div class="dot"></div>
                </div>
            </div>
            <div class="action-box" id="action-panel">
                <p style="color:#aaa; font-size:0.9rem;">Kamu mau maafin aku gak?</p>
                <button class="btn-main" id="btn-forgive">Maafin aja deh, betmut</button>
            </div>
        </div>
    </div>

    <!-- FINAL -->
    <div id="layer-final-text">I Love You, Momoca</div>

    <!-- CANVASES -->
    <canvas id="canvas-stickman"></canvas>
    <canvas id="canvas-3d"></canvas> <!-- THREE.JS RENDER TARGET -->

    <!-- AUDIO -->
    <div style="position:fixed; opacity:0; pointer-events:none;">
        <iframe id="spotify" src="https://open.spotify.com/embed/track/3Qiv7UhkqYeBExD6gZ1m3k?utm_source=generator&theme=0" width="100" height="100" allow="autoplay"></iframe>
    </div>

    <script>
        // PASTIKAN SEMUA LOAD DULU
        window.addEventListener('load', () => {

            // --- CONFIG ---
            const overlay = document.getElementById('layer-overlay');
            const introBox = document.getElementById('intro-box');
            const igUI = document.getElementById('ig-interface');
            const chatBody = document.getElementById('chat-scroller');
            const typing = document.getElementById('typing-dots');
            const actionPanel = document.getElementById('action-panel');
            const canvas2D = document.getElementById('canvas-stickman');
            const canvas3D = document.getElementById('canvas-3d');
            const finalText = document.getElementById('layer-final-text');
            
            let isStarted = false;

            // --- START HANDLER ---
            const startAll = () => {
                if(isStarted) return;
                isStarted = true;

                // Audio Trigger
                document.getElementById('spotify').src += ""; 

                // Hide Overlay
                overlay.style.opacity = 0;
                setTimeout(() => overlay.style.display = 'none', 1000);

                // Play Intro
                const lines = document.querySelectorAll('.intro-line');
                setTimeout(() => lines[0].classList.add('intro-active'), 500);
                setTimeout(() => lines[1].classList.add('intro-active'), 2500);
                setTimeout(() => lines[2].classList.add('intro-active'), 4500);

                // Switch to Chat
                setTimeout(() => {
                    introBox.style.opacity = 0;
                    setTimeout(() => {
                        introBox.style.display = 'none';
                        igUI.style.display = 'flex';
                        playChat();
                    }, 1000);
                }, 7500);
            };

            overlay.addEventListener('click', startAll);
            overlay.addEventListener('touchstart', startAll);

            // --- CHAT SYSTEM ---
            const addMsg = (txt, side) => {
                const d = document.createElement('div');
                d.className = `msg msg-${side}`;
                d.innerText = txt;
                chatBody.insertBefore(d, typing);
                requestAnimationFrame(() => d.classList.add('show'));
                chatBody.scrollTop = chatBody.scrollHeight;
            };

            const playChat = async () => {
                const sleep = ms => new Promise(r => setTimeout(r, ms));
                
                // Typing 1
                typing.style.display = 'block';
                await sleep(1000);
                typing.style.display = 'none';
                addMsg("haloo", 'l');
                
                // Reply
                await sleep(1000);
                addMsg("haloo juga", 'r');
                
                // Typing 2
                await sleep(500);
                typing.style.display = 'block';
                chatBody.scrollTop = chatBody.scrollHeight;
                await sleep(1500);
                typing.style.display = 'none';
                addMsg("ini momoca ya?", 'l');

                // Action
                await sleep(1000);
                actionPanel.style.display = 'flex';
                // reflow
                void actionPanel.offsetWidth;
                actionPanel.style.opacity = 1;
                chatBody.scrollTop = chatBody.scrollHeight;
            };

            document.getElementById('btn-forgive').onclick = () => {
                // Exit Chat
                igUI.style.transition = "transform 1s, opacity 1s";
                igUI.style.transform = "scale(0.9)";
                igUI.style.opacity = 0;
                setTimeout(() => {
                    igUI.style.display = 'none';
                    initStickmanAnim();
                }, 1000);
            };

            // ===============================================
            // 2D STICKMAN ANIMATION (Smooth Canvas API)
            // ===============================================
            const ctx = canvas2D.getContext('2d');
            let w, h;
            
            const resize = () => {
                w = window.innerWidth;
                h = window.innerHeight;
                canvas2D.width = w; canvas2D.height = h;
                // 3D Resize handled later
            };
            window.addEventListener('resize', resize);
            resize();

            let smState = 'WALK'; 
            let boyX = -50;
            let boyY = 0; // set in loop
            let girlX = 0; 
            let frame = 0;

            const drawMan = (x, y, isGirl, isWalk) => {
                ctx.save();
                ctx.translate(x, y);
                ctx.scale(1.2, 1.2);
                ctx.strokeStyle = 'white'; ctx.lineWidth = 3; ctx.lineCap = 'round'; ctx.lineJoin = 'round';

                // Physics
                let bounce = isWalk ? Math.abs(Math.sin(frame*0.15))*5 : 0;
                
                // Head
                ctx.beginPath(); ctx.arc(0, -50-bounce, 10, 0, Math.PI*2); ctx.stroke();
                // Body
                ctx.beginPath(); ctx.moveTo(0, -40-bounce); ctx.lineTo(0, 0-bounce); ctx.stroke();
                
                // Legs (Smooth Sin Wave)
                ctx.beginPath(); ctx.moveTo(0,0-bounce);
                let la = isWalk ? Math.sin(frame*0.15)*0.8 : 0;
                ctx.lineTo(Math.sin(la)*-20, Math.cos(la)*30 - bounce); ctx.stroke(); // L

                ctx.beginPath(); ctx.moveTo(0,0-bounce);
                let ra = isWalk ? Math.sin(frame*0.15 + Math.PI)*0.8 : 0;
                ctx.lineTo(Math.sin(ra)*-20, Math.cos(ra)*30 - bounce); ctx.stroke(); // R

                // Arms
                ctx.beginPath(); ctx.moveTo(0, -35-bounce);
                if(isWalk) {
                     ctx.lineTo(Math.sin(frame*0.15 + Math.PI)*15, -10-bounce);
                } else if (!isGirl && smState === 'GIVE') {
                     ctx.lineTo(25, -35-bounce); // Give
                } else {
                     ctx.lineTo(0, -10-bounce);
                }
                ctx.stroke();

                if(isGirl) {
                    ctx.fillStyle='white'; ctx.beginPath(); ctx.moveTo(0,-25-bounce); ctx.lineTo(-12,10-bounce); ctx.lineTo(12,10-bounce); ctx.fill();
                }
                ctx.restore();
            };

            const initStickmanAnim = () => {
                boyY = h/2 + 150;
                girlX = w/2 + 60;
                animLoop2D();
            };

            const animLoop2D = () => {
                ctx.clearRect(0,0,w,h);
                frame++;

                // Floor
                ctx.strokeStyle = '#333'; ctx.beginPath(); ctx.moveTo(0, boyY); ctx.lineTo(w, boyY); ctx.stroke();

                if(smState === 'WALK') {
                    boyX += 2.5;
                    if(boyX >= w/2 - 60) {
                        smState = 'GIVE';
                        frame = 0;
                        // PREPARE 3D
                        initThreeJS();
                    }
                }

                drawMan(boyX, boyY, false, smState === 'WALK');
                drawMan(girlX, boyY, true, false);

                if(smState === 'GIVE') {
                    if(frame > 60) {
                        // FADE OUT 2D, SHOW 3D
                        canvas2D.style.transition = 'opacity 1s';
                        canvas2D.style.opacity = 0;
                        canvas3D.style.opacity = 1;
                        finalText.style.opacity = 1;
                    }
                }

                if(canvas3D.style.opacity != '1') {
                    requestAnimationFrame(animLoop2D);
                }
            };

            // ===============================================
            // 3D ENGINE (THREE.JS) - HIGH QUALITY FLOWER
            // ===============================================
            let renderer, scene, camera, lilyGroup, particles;
            let bloomProgress = 0;

            const initThreeJS = () => {
                // 1. Setup
                scene = new THREE.Scene();
                // Add soft fog for depth
                scene.fog = new THREE.FogExp2(0x000000, 0.02);

                camera = new THREE.PerspectiveCamera(45, w/h, 0.1, 1000);
                camera.position.set(0, 3, 14); // Zoom out a bit
                camera.lookAt(0, 2, 0);

                renderer = new THREE.WebGLRenderer({ canvas: canvas3D, alpha: true, antialias: true });
                renderer.setSize(w, h);
                renderer.setPixelRatio(window.devicePixelRatio);
                renderer.toneMapping = THREE.ReinhardToneMapping;

                // 2. Lights (Cinematic)
                const ambient = new THREE.AmbientLight(0xffffff, 0.4);
                scene.add(ambient);

                // Main Pink Glow
                const spot = new THREE.SpotLight(0xff69b4, 2);
                spot.position.set(5, 10, 5);
                spot.angle = 0.5;
                spot.penumbra = 1;
                scene.add(spot);

                const point = new THREE.PointLight(0xffb7b2, 1, 10);
                point.position.set(-2, 2, 2);
                scene.add(point);

                // 3. Procedural Lily Geometry
                createLilyModel();
                createMagicDust();

                // 4. Start Loop
                animLoop3D();
            };

            const createLilyModel = () => {
                lilyGroup = new THREE.Group();

                // A. The Stem (Curved Tube)
                const path = new THREE.CatmullRomCurve3([
                    new THREE.Vector3(0, -6, 0),
                    new THREE.Vector3(0.5, -3, 0),
                    new THREE.Vector3(0, 0, 0)
                ]);
                const stemGeo = new THREE.TubeGeometry(path, 64, 0.15, 8, false);
                const stemMat = new THREE.MeshStandardMaterial({ color: 0x4caf50, roughness: 0.8 });
                const stem = new THREE.Mesh(stemGeo, stemMat);
                lilyGroup.add(stem);

                // B. The Petal (Custom Shape)
                // Draw half a teardrop shape then extrude
                const shape = new THREE.Shape();
                shape.moveTo(0,0);
                // Control points for a Lily petal shape (Long, tapered)
                shape.bezierCurveTo(0.4, 0.5, 0.8, 1.5, 0, 4.5); // Right side curve
                shape.bezierCurveTo(-0.8, 1.5, -0.4, 0.5, 0, 0); // Left side curve

                const extrudeSettings = {
                    steps: 2,
                    depth: 0.05, // Thickness
                    bevelEnabled: true,
                    bevelThickness: 0.02,
                    bevelSize: 0.02,
                    bevelSegments: 2
                };
                const petalGeo = new THREE.ExtrudeGeometry(shape, extrudeSettings);
                // Shift Pivot to bottom
                petalGeo.translate(0,0,0);

                // Petal Material (Subsurface Scattering fake effect with emissive)
                const petalMat = new THREE.MeshStandardMaterial({
                    color: 0xffffff, // White Base
                    emissive: 0xffaacc, // Pink Glow
                    emissiveIntensity: 0.3,
                    roughness: 0.3,
                    metalness: 0.1,
                    side: THREE.DoubleSide
                });

                // Create 6 Petals
                for(let i=0; i<6; i++) {
                    const pContainer = new THREE.Group();
                    const petalMesh = new THREE.Mesh(petalGeo, petalMat);
                    
                    // Natural bend of the petal
                    petalMesh.rotation.x = -0.3; 
                    
                    pContainer.add(petalMesh);

                    // Arrange in circle
                    pContainer.rotation.z = (i * 60) * Math.PI / 180;
                    
                    // Set initial CLOSED state (Folded up)
                    pContainer.rotation.x = 1.6; // Almost vertical
                    
                    // Metadata for animation
                    pContainer.userData = { 
                        targetX: 0.8, // Open angle
                        isInner: i % 2 !== 0
                    };
                    
                    if(pContainer.userData.isInner) {
                         pContainer.userData.targetX = 1.0; // Inner petals stand up more
                         petalMesh.position.y = 0.1; // Offset slightly
                    }

                    lilyGroup.add(pContainer);
                }

                // C. Stamens (Putik)
                for(let k=0; k<6; k++) {
                    const sGeo = new THREE.CylinderGeometry(0.02, 0.02, 2.5, 8);
                    const sMat = new THREE.MeshBasicMaterial({ color: 0xffd700 });
                    const stamen = new THREE.Mesh(sGeo, sMat);
                    stamen.position.y = 1;
                    // Random slight spread
                    stamen.rotation.x = (Math.random()-0.5) * 0.5;
                    stamen.rotation.z = (Math.random()-0.5) * 0.5;
                    lilyGroup.add(stamen);
                }

                lilyGroup.scale.set(0,0,0); // Start hidden
                scene.add(lilyGroup);
            };

            const createMagicDust = () => {
                const count = 300;
                const geo = new THREE.BufferGeometry();
                const pos = [];
                for(let i=0; i<count; i++) {
                    pos.push((Math.random()-0.5)*15); // x
                    pos.push((Math.random()-0.5)*15 + 3); // y
                    pos.push((Math.random()-0.5)*15); // z
                }
                geo.setAttribute('position', new THREE.Float32BufferAttribute(pos, 3));
                const mat = new THREE.PointsMaterial({
                    color: 0xffc0cb,
                    size: 0.1,
                    transparent: true,
                    opacity: 0.8,
                    blending: THREE.AdditiveBlending
                });
                particles = new THREE.Points(geo, mat);
                scene.add(particles);
            };

            const animLoop3D = () => {
                requestAnimationFrame(animLoop3D);
                const t = Date.now() * 0.001;

                // 1. Growth Animation
                if(bloomProgress < 1) {
                    bloomProgress += 0.008;
                    // Easing scale
                    let s = bloomProgress;
                    lilyGroup.scale.set(s,s,s);
                }

                // 2. Petal Opening Logic
                lilyGroup.children.forEach(child => {
                    if(child.userData.targetX && bloomProgress > 0.3) {
                        // Smoothly interpolate current rotation to target rotation
                        child.rotation.x = THREE.MathUtils.lerp(child.rotation.x, child.userData.targetX, 0.03);
                    }
                });

                // 3. Organic Swaying (Wind)
                lilyGroup.rotation.y = Math.sin(t*0.5) * 0.2 + (t*0.1); // Spin slowly + Sway
                lilyGroup.rotation.z = Math.cos(t*0.3) * 0.05;
                lilyGroup.position.y = Math.sin(t) * 0.3; // Floating up/down

                // 4. Particle Field Spin
                particles.rotation.y = -t * 0.05;
                
                renderer.render(scene, camera);
            };
        });
    </script>
</body>
</html>





 



